import{r as p,u as M,h as P,f as v,S as n,i as f,c as i,a as t,t as d,j as c,w as k,v as V,n as w,k as T,F as b,l as x,o as l}from"./index-CQnAB9m_.js";const j={id:"todoListPage",class:"bg-half"},E={class:"todo_sm"},F={href:"#"},R={class:"conatiner todoListPage vhContainer"},U={class:"todoList_Content"},q={class:"inputBox"},G={key:0,class:"todoList_list"},H={class:"todoList_tab"},J={class:"todoList_items"},K={class:"todoList_item"},Q={class:"todoList_label"},W=["checked","onChange"],X=["onClick"],Y={class:"todoList_statistics"},Z={class:"todoList_items"},tt={class:"todoList_item"},et={class:"todoList_label"},st=["checked","onChange"],ot=["onClick"],nt={class:"todoList_statistics"},it={class:"todoList_items"},lt={class:"todoList_item"},at={class:"todoList_label"},rt=["checked","onChange"],ct=["onClick"],ut={class:"todoList_statistics"},dt={key:1,class:"noitem"},h="https://todolist-api.hexschool.io",_t={__name:"TodolistView",setup(vt){const a=p(""),O=M(),g=p({status:"",exp:"",token:"",nickname:""});P(async()=>{const e=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoName\s*\=\s*([^;]*).*$)|^.*$/,"$1");await v.get(`${h}/users/checkout`,{headers:{Authorization:e}}).then(s=>{g.value=s.data,a.value=e,L()}).catch(function(s){a.value="",n.fire({icon:"error",title:"請重新登入",showConfirmButton:!1,timer:1500}),setTimeout(()=>{O.push("/login")},1500)})});const z=async()=>{try{const e=await v.post(`${h}/users/sign_out`,{},{headers:{Authorization:a.value}});n.fire({title:"期待下次再見",icon:"success",showConfirmButton:!1,timer:1500}),g.value={},a.value="",setTimeout(()=>{O.push("/login")},1500)}catch{n.fire({icon:"error",title:"登出失敗"})}},u=p("1"),C=e=>{u.value=e},r=p([]),m=p(""),L=async()=>{try{const e=await v.get(`${h}/todos/`,{headers:{Authorization:a.value}});r.value=e.data.data}catch{n.fire({icon:"error",title:"資料取得失敗"})}},A=async()=>{const e={content:m.value};if(!e.content.trim()){n.fire({icon:"error",title:"內容不可以是空白唷"});return}try{const s=await v.post(`${h}/todos/`,e,{headers:{Authorization:a.value}});n.fire({title:"新增成功！",icon:"success",showConfirmButton:!1,timer:1e3}),m.value="",L()}catch{n.fire({icon:"error",title:"資料新增失敗！"})}},S=f(()=>r.value),D=f(()=>r.value.filter(e=>e.status===!1)),B=f(()=>r.value.filter(e=>e.status===!1).length),N=f(()=>r.value.filter(e=>e.status===!0)),I=f(()=>r.value.filter(e=>e.status===!0).length),y=async e=>{try{const s=await v.patch(`${h}/todos/${e}/toggle`,{},{headers:{Authorization:a.value}});L()}catch{n.fire({icon:"error",title:"狀態更新失敗！"})}},$=async e=>{try{await v.delete(`${h}/todos/${e}`,{headers:{Authorization:a.value}}),r.value.splice(e,1),n.fire({title:"刪除成功！",icon:"success",showConfirmButton:!1,timer:1e3})}catch{n.fire({icon:"error",title:"刪除失敗！"})}};return(e,s)=>(l(),i("div",j,[t("nav",null,[s[4]||(s[4]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",E,[t("a",F,[t("span",null,d(g.value.nickname)+"的代辦事項",1)])]),t("li",null,[t("a",{href:"#loginPage",onClick:c(z,["prevent"])},"登出")])])]),t("div",R,[t("div",U,[t("div",q,[k(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[0]||(s[0]=o=>m.value=o)},null,512),[[V,m.value]]),t("a",{href:"#",onClick:c(A,["prevent"])},s[5]||(s[5]=[t("i",{class:"fa fa-plus"},null,-1)]))]),r.value.length>0?(l(),i("div",G,[t("ul",H,[t("li",null,[t("a",{href:"#",class:w(u.value==="1"?"active":""),onClick:s[1]||(s[1]=c(o=>C("1"),["prevent"]))},"全部",2)]),t("li",null,[t("a",{href:"#",class:w(u.value==="2"?"active":""),onClick:s[2]||(s[2]=c(o=>C("2"),["prevent"]))},"待完成",2)]),t("li",null,[t("a",{href:"#",class:w(u.value==="3"?"active":""),onClick:s[3]||(s[3]=c(o=>C("3"),["prevent"]))},"已完成",2)])]),k(t("div",J,[t("ul",K,[(l(!0),i(b,null,x(S.value,o=>(l(),i("li",{key:o.id},[t("label",Q,[t("input",{class:"todoList_input",type:"checkbox",value:"true",checked:o.status,onChange:_=>y(o.id)},null,40,W),t("span",null,d(o.content),1)]),t("a",{href:"#",onClick:c(_=>$(o.id),["prevent"])},s[6]||(s[6]=[t("i",{class:"fa fa-times"},null,-1)]),8,X)]))),128))]),t("div",Y,[t("p",null,d(B.value)+" 個待完成項目",1)])],512),[[T,u.value==="1"]]),k(t("div",Z,[t("ul",tt,[(l(!0),i(b,null,x(D.value,o=>(l(),i("li",{key:o.id},[t("label",et,[t("input",{class:"todoList_input",type:"checkbox",value:"true",checked:o.status,onChange:_=>y(o.id)},null,40,st),t("span",null,d(o.content),1)]),t("a",{href:"#",onClick:c(_=>$(o.id),["prevent"])},s[7]||(s[7]=[t("i",{class:"fa fa-times"},null,-1)]),8,ot)]))),128))]),t("div",nt,[t("p",null,d(B.value)+" 個待完成項目",1)])],512),[[T,u.value==="2"]]),k(t("div",it,[t("ul",lt,[(l(!0),i(b,null,x(N.value,o=>(l(),i("li",{key:o.id},[t("label",at,[t("input",{class:"todoList_input",type:"checkbox",value:"true",checked:o.status,onChange:_=>y(o.id)},null,40,rt),t("span",null,d(o.content),1)]),t("a",{href:"#",onClick:c(_=>$(o.id),["prevent"])},s[8]||(s[8]=[t("i",{class:"fa fa-times"},null,-1)]),8,ct)]))),128))]),t("div",ut,[t("p",null,d(I.value)+" 個已完成項目",1)])],512),[[T,u.value==="3"]])])):(l(),i("div",dt,"目前尚無待辦事項"))])])]))}};export{_t as default};
