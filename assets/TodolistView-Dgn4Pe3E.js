import{r as _,u as I,h as M,f as d,i as p,c as o,a as t,t as r,j as u,w as m,v as P,n as $,k as T,F as b,l as w,o as n}from"./index-CG1E3f6r.js";const V={id:"todoListPage",class:"bg-half"},j={class:"todo_sm"},E={href:"#"},F={class:"conatiner todoListPage vhContainer"},R={class:"todoList_Content"},U={class:"inputBox"},q={key:0,class:"todoList_list"},G={class:"todoList_tab"},H={class:"todoList_items"},J={class:"todoList_item"},K={class:"todoList_label"},Q=["checked","onChange"],W=["onClick"],X={class:"todoList_statistics"},Y={class:"todoList_items"},Z={class:"todoList_item"},tt={class:"todoList_label"},et=["checked","onChange"],st=["onClick"],at={class:"todoList_statistics"},ot={class:"todoList_items"},nt={class:"todoList_item"},lt={class:"todoList_label"},it=["checked","onChange"],ut=["onClick"],ct={class:"todoList_statistics"},rt={key:1,class:"noitem"},v="https://todolist-api.hexschool.io",ht={__name:"TodolistView",setup(dt){const l=_(""),x=I(),f=_({status:"",exp:"",token:"",nickname:""});M(async()=>{const s=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoName\s*\=\s*([^;]*).*$)|^.*$/,"$1");await d.get(`${v}/users/checkout`,{headers:{Authorization:s}}).then(e=>{f.value=e.data,l.value=s,L()}).catch(function(e){l.value="",alert("請重新登入："+e.message),setTimeout(()=>{x.push("/login")},1500)})});const z=async()=>{try{const s=await d.post(`${v}/users/sign_out`,{},{headers:{Authorization:l.value}});f.value={},l.value="",alert("登出成功！"),setTimeout(()=>{x.push("/login")},1e3)}catch(s){alert("登出失敗："+s.message)}},c=_("1"),g=s=>{c.value=s},i=_([]),k=_(""),L=async()=>{try{const s=await d.get(`${v}/todos/`,{headers:{Authorization:l.value}});i.value=s.data.data}catch(s){alert("資料取得失敗："+s.message)}},A=async()=>{const s={content:k.value};if(!s.content.trim()){alert("內容不可以是空白唷");return}try{const e=await d.post(`${v}/todos/`,s,{headers:{Authorization:l.value}});alert("新增成功！"),k.value="",L()}catch(e){alert("新增失敗："+e.message)}},B=p(()=>i.value),D=p(()=>i.value.filter(s=>s.status===!1)),O=p(()=>i.value.filter(s=>s.status===!1).length),N=p(()=>i.value.filter(s=>s.status===!0)),S=p(()=>i.value.filter(s=>s.status===!0).length),y=async s=>{try{const e=await d.patch(`${v}/todos/${s}/toggle`,{},{headers:{Authorization:l.value}});L()}catch(e){alert("狀態更新失敗："+e.message)}},C=async s=>{try{await d.delete(`${v}/todos/${s}`,{headers:{Authorization:l.value}}),i.value.splice(s,1),alert("刪除成功！")}catch(e){alert("刪除失敗："+e.message)}};return(s,e)=>(n(),o("div",V,[t("nav",null,[e[4]||(e[4]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",j,[t("a",E,[t("span",null,r(f.value.nickname)+"的代辦事項",1)])]),t("li",null,[t("a",{href:"#loginPage",onClick:u(z,["prevent"])},"登出")])])]),t("div",F,[t("div",R,[t("div",U,[m(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a)},null,512),[[P,k.value]]),t("a",{href:"#",onClick:u(A,["prevent"])},e[5]||(e[5]=[t("i",{class:"fa fa-plus"},null,-1)]))]),i.value.length>0?(n(),o("div",q,[t("ul",G,[t("li",null,[t("a",{href:"#",class:$(c.value==="1"?"active":""),onClick:e[1]||(e[1]=u(a=>g("1"),["prevent"]))},"全部",2)]),t("li",null,[t("a",{href:"#",class:$(c.value==="2"?"active":""),onClick:e[2]||(e[2]=u(a=>g("2"),["prevent"]))},"待完成",2)]),t("li",null,[t("a",{href:"#",class:$(c.value==="3"?"active":""),onClick:e[3]||(e[3]=u(a=>g("3"),["prevent"]))},"已完成",2)])]),m(t("div",H,[t("ul",J,[(n(!0),o(b,null,w(B.value,a=>(n(),o("li",{key:a.id},[t("label",K,[t("input",{class:"todoList_input",type:"checkbox",value:"true",checked:a.status,onChange:h=>y(a.id)},null,40,Q),t("span",null,r(a.content),1)]),t("a",{href:"#",onClick:u(h=>C(a.id),["prevent"])},e[6]||(e[6]=[t("i",{class:"fa fa-times"},null,-1)]),8,W)]))),128))]),t("div",X,[t("p",null,r(O.value)+" 個待完成項目",1)])],512),[[T,c.value==="1"]]),m(t("div",Y,[t("ul",Z,[(n(!0),o(b,null,w(D.value,a=>(n(),o("li",{key:a.id},[t("label",tt,[t("input",{class:"todoList_input",type:"checkbox",value:"true",checked:a.status,onChange:h=>y(a.id)},null,40,et),t("span",null,r(a.content),1)]),t("a",{href:"#",onClick:u(h=>C(a.id),["prevent"])},e[7]||(e[7]=[t("i",{class:"fa fa-times"},null,-1)]),8,st)]))),128))]),t("div",at,[t("p",null,r(O.value)+" 個待完成項目",1)])],512),[[T,c.value==="2"]]),m(t("div",ot,[t("ul",nt,[(n(!0),o(b,null,w(N.value,a=>(n(),o("li",{key:a.id},[t("label",lt,[t("input",{class:"todoList_input",type:"checkbox",value:"true",checked:a.status,onChange:h=>y(a.id)},null,40,it),t("span",null,r(a.content),1)]),t("a",{href:"#",onClick:u(h=>C(a.id),["prevent"])},e[8]||(e[8]=[t("i",{class:"fa fa-times"},null,-1)]),8,ut)]))),128))]),t("div",ct,[t("p",null,r(S.value)+" 個已完成項目",1)])],512),[[T,c.value==="3"]])])):(n(),o("div",rt,"目前尚無待辦事項"))])])]))}};export{ht as default};
